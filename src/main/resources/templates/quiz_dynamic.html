<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Generated Quiz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #111827;
            color: #E5E7EB;
            font-family: 'Segoe UI', system-ui, sans-serif;
            padding: 2rem 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        /* Added Aurora background */
        .aurora-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at 20% 30%, rgba(138, 43, 226, 0.7) 0%, transparent 60%),
            radial-gradient(ellipse at 80% 50%, rgba(0, 191, 255, 0.6) 0%, transparent 70%),
            linear-gradient(135deg, #000000 0%, #0a0520 100%);
            animation: aurora-drift 25s infinite alternate ease-in-out;
            z-index: -1;
        }
        @keyframes aurora-drift {
            from { background-position: 0% 0%, 0% 0%, 0% 0%; }
            to { background-position: 5% 10%, -10% -5%, 15% 0%; }
        }

       .container { max-width: 800px; width: 90%; position: relative; z-index: 1;}
       .card {
           background-color: rgba(31, 41, 55, 0.8); /* Dark glass effect */
           border: 1px solid #374151;
           border-radius: 1.5rem;
           backdrop-filter: blur(10px);
       }

       /* === ‚úÖ FIX: Make headings and questions visible === */
       .card h2 {
           color: #F9FAFB !important; /* Make main heading bright white */
           font-weight: 700;
       }
       .card h5 {
           color: #9CA3AF !important; /* Make subheading lighter grey */
       }
       .question-container p {
           color: #E5E7EB !important; /* Make question text light */
           font-size: 1.15rem; /* Make it a bit bigger */
           font-weight: 600 !important;
       }
       /* ============================================== */

       .question-container {
           background-color: #111827;
           border: 1px solid #374151 !important;
           border-radius: 1rem;
       }
       .option-card {
           display: flex;
           align-items: center;
           justify-content: space-between;
           position: relative;
           padding: 1rem 1.25rem;
           margin: 0.5rem 0;
           border-radius: 9999px; /* Pill shape */
           background: #374151;
           color: #D1D5DB;
           border: 1px solid #4B5563;
           cursor: pointer;
           user-select: none;
           transition: border-color 0.2s;
       }
       .option-card input[type=radio] { position: absolute; opacity: 0; }
       .checkmark {
           position: relative;
           height: 25px;
           width: 25px;
           min-width: 25px;
           background-color: #4B5563;
           border-radius: 50%;
           border: 1px solid #9CA3AF;
           transition: background-color 0.2s, box-shadow 0.2s;
       }
       .option-card:hover { border-color: #8B5CF6; }
       .option-card.selected {
           border-color: #8B5CF6;
       }
       .option-card.selected .checkmark {
           background-color: #000;
           box-shadow: 0 0 15px 3px rgba(139, 92, 246, 0.6);
       }
       .checkmark:after {
           content: "";
           position: absolute;
           display: none;
           left: 9px;
           top: 5px;
           width: 7px;
           height: 13px;
           border: solid white;
           border-width: 0 3px 3px 0;
           transform: rotate(45deg);
       }
       .option-card.selected .checkmark:after { display: block; }
       .fill-in-blank-input {
           width: 100%;
           padding: 0.75rem 1rem;
           background-color: #374151;
           border: 1px solid #4B5563;
           border-radius: 9999px; /* Pill shape */
           color: #E5E7EB;
           font-size: 1rem;
       }
       .fill-in-blank-input:focus {
           outline: none;
           border-color: #8B5CF6;
           box-shadow: 0 0 15px 3px rgba(139, 92, 246, 0.6);
       }
       button[type="submit"] {
           background: linear-gradient(to right, #6D28D9, #8B5CF6);
           color: white;
           border: none;
           font-weight: bold;
           border-radius: 9999px; /* Pill shape */
           padding: 0.75rem;
           transition: transform 0.2s, box-shadow 0.2s;
       }
       button[type="submit"]:hover {
           transform: translateY(-2px);
           box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
       }

       #timer-display {
            background: rgba(17, 24, 39, 0.7);
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            border: 1px solid #374151;
            color: #E5E7EB;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
       }
       #timer-display.low-time {
           color: #F87171;
           border-color: #F87171;
           animation: pulse-red 1s infinite;
       }
       @keyframes pulse-red {
           0% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0.4); }
           70% { box-shadow: 0 0 0 10px rgba(248, 113, 113, 0); }
           100% { box-shadow: 0 0 0 0 rgba(248, 113, 113, 0); }
       }
    </style>
</head>
<body class="py-5">
<div class="aurora-background"></div>
<div class="container">
    <div class="card p-4 p-md-5">
        <h2 class="text-center mb-4">üìù Quiz on "<span th:text="${quiz.topic}"></span>"</h2>

        <div class="d-flex justify-content-between align-items: center mb-4 px-3">
            <h5 class="text-center text-muted mb-0">Difficulty: <span th:text="${quiz.difficulty}"></span></h5>
            <div id="timer-display" th:if="${totalTime > 0}">
                <span id="time-minutes">00</span>:<span id="time-seconds">00</span>
            </div>
        </div>

        <form id="quiz-form" action="/submit" method="post">
            <div th:each="q, iterStat : ${quiz.questions}" class="mb-4 p-3 question-container">
                <p class.="fw-bold" th:text="${iterStat.index + 1} + '. ' + ${q.question}"></p>

                <div th:if="${q.options != null and not #lists.isEmpty(q.options)}">
                    <!-- Multiple Choice Rendering -->
                    <div th:each="opt : ${q.options}">
                        <label class="option-card">
                            <span style="flex-grow: 1; margin-right: 10px;" th:text="${opt}"></span>
                            <input type="radio" th:name="${'q' + iterStat.index}" th:value="${opt}" required onclick="updateSelected(this)">
                            <span class="checkmark"></span>
                        </label>
                    </div>
                </div>

                <div th:unless="${q.options != null and not #lists.isEmpty(q.options)}">
                    <!-- ‚úÖ FIX: Added autocomplete="off" to stop suggestions -->
                    <input type="text" th:name="${'q' + iterStat.index}" class="fill-in-blank-input"
                           placeholder="Type your answer here..." required autocomplete="off">
                </div>

            </div>
            <button type="submit" class="w-100 mt-3 p-2">Submit Quiz</button>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
    function updateSelected(radio) {
        let questionContainer = radio.closest('.question-container');
        questionContainer.querySelectorAll('.option-card').forEach(opt => opt.classList.remove('selected'));
        radio.closest('.option-card').classList.add('selected');
    }

    /* === ‚úÖ MODIFIED TIMER SCRIPT === */

    // Get the total time value from the model (defaults to 600 if not present)
    const totalTimeInSeconds = /*[[${totalTime}]]*/ 600;

    if (totalTimeInSeconds > 0) {
        let totalSeconds = totalTimeInSeconds; // Use the new totalTime variable

        const minutesDisplay = document.getElementById('time-minutes');
        const secondsDisplay = document.getElementById('time-seconds');
        const timerDisplay = document.getElementById('timer-display');
        const quizForm = document.getElementById('quiz-form');

        function updateTimerDisplay() {
            let minutes = Math.floor(totalSeconds / 60);
            let seconds = totalSeconds % 60;

            minutesDisplay.textContent = minutes < 10 ? '0' + minutes : minutes;
            secondsDisplay.textContent = seconds < 10 ? '0' + seconds : seconds;

            if (totalSeconds <= 30) {
                timerDisplay.classList.add('low-time');
            }
        }

        updateTimerDisplay(); // Initial display

        const timerInterval = setInterval(() => {
            totalSeconds--;
            updateTimerDisplay();

            if (totalSeconds <= 0) {
                clearInterval(timerInterval);
                quizForm.submit();
            }
        }, 1000);
    }
    /* ========================= */
</script>
</body>
</html>